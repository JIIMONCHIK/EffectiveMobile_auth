# Система аутентификации и авторизации
Backend-приложение с собственной системой аутентификации и авторизации, реализованное на FastAPI с использованием PostgreSQL. Система предоставляет ролевую модель доступа с тонкой настройкой прав для различных бизнес-объектов.

## Описание системы доступа

Система использует ролевую модель доступа (RBAC) с дополнительными пермишенами для конкретных действий.
Поддерживаются 7 типов прав для каждого бизнес-объекта:

- read - чтение своих объектов

- read_all - чтение всех объектов

- create - создание объектов

- update - обновление своих объектов

- update_all - обновление всех объектов

- delete - удаление своих объектов

- delete_all - удаление всех объектов


## Структура:
```
app/
├── main.py              # Основное приложение и эндпоинты
├── auth.py              # Аутентификация и авторизация
├── models.py            # Модели базы данных (SQLAlchemy)
├── schemas.py           # Pydantic схемы для API
├── database.py          # Подключение к БД
└── config.py            # Конфигурация приложения
```

## Запуск
```bash
docker-compose up --build
```
Приложение будет доступно по адресу: http://localhost:8000

Документация API (Swagger): http://localhost:8000/docs

## Функционал

### Аутентификация

- Регистрация новых пользователей

- Вход в систему (JWT токены)

- Выход из системы с инвалидацией токенов

- Проверка статуса аутентификации

### Управление пользователями

- Просмотр и редактирование своего профиля

- Мягкое удаление аккаунта

- Автоматическая проверка уникальности email

### Система авторизации

- Ролевая модель доступа (RBAC)

- Тонкая настройка прав для каждого бизнес-объекта

- Проверка прав доступа к эндпоинтам

- Разделение прав на свои и все объекты

### Бизнес-логика

- Mock endpoints для продуктов и заказов

- Административное управление правами доступа

- Система версионирования токенов

## Эндпоинты API

### Публичные эндпоинты
```
POST	/register	Регистрация нового пользователя
POST	/login	    Вход в систему
GET	    /	        Статус API
GET	    /health	    Health check
```

### Защищенные эндпоинты (требуют аутентификации)
```
GET	    /users/me	Информация о текущем пользователе
PUT	    /users/me	Обновление профиля
DELETE	/users/me	Удаление аккаунт
POST	/logout	    Выход из системы
```

### Эндпоинты для продуктов
```
GET	    /products	    Получить список продуктов
POST	/products	    Создать продукт
PUT	    /products/{id}	Обновить продукт
DELETE	/products/{id}	Удалить продукт
```

### Эндпоинты для заказов
```
GET	    /orders     Получить список заказов
```

### Админские эндпоинты
```
GET	/admin/users	            Список всех пользователей
GET	/admin/access-rules	        Список правил доступа
PUT	/admin/access-rules/{id}	Обновление правил доступа	
```

## Тестовые данные

При первом запуске автоматически создаются:

Администратор
- Email: admin@example.com

- Пароль: admin123

- Права: Полный доступ ко всем функциям системы

Менеджер
- Email: manager@example.com

- Пароль: manager123

- Права: Чтение и обновление всех данных, кроме удаления

Обычный пользователь
- Email: user@example.com

- Пароль: user123

- Права:

    - Полный доступ к своему профилю

    - Просмотр продуктов

    - Создание и управление своими заказами
